<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">éšæœºé€‰æ‹©å™¨ - è‡ªå®šä¹‰æ¬¡æ•°</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        :root {
            --primary: #4F46E5;
            --secondary: #10B981;
            --accent: #8B5CF6;
            --neutral: #1F2937;
            --bg-light: #f9fafb;
            --bg-white: #ffffff;
            --text-dark: #1F2937;
            --text-gray: #6B7280;
            --border-light: #E5E7EB;
            /* å“åº”å¼ç›¸å…³å˜é‡ */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --border-radius: 0.75rem;
            --input-height: 2.75rem;
        }
        
        /* æ·±è‰²æ¨¡å¼å˜é‡ - ä¿æŒè‰²è°ƒä¸€è‡´ï¼Œè°ƒæ•´äº®åº¦å’Œå¯¹æ¯”åº¦ */
        :root.dark-theme {
            --primary: #6366f1; /* æ¯”æµ…è‰²æ¨¡å¼ç¨äº®çš„ç´«è‰² */
            --secondary: #34d399; /* æ¯”æµ…è‰²æ¨¡å¼ç¨äº®çš„ç»¿è‰² */
            --accent: #a78bfa; /* æ¯”æµ…è‰²æ¨¡å¼ç¨äº®çš„ç²‰è‰² */
            --bg-light: #0f172a; /* æ·±è“é»‘è‰²èƒŒæ™¯ */
            --bg-white: #1e293b; /* å¡ç‰‡æ·±è‰²èƒŒæ™¯ */
            --text-dark: #f1f5f9; /* æµ…è‰²æ–‡æœ¬ */
            --text-gray: #cbd5e1; /* ç°è‰²æ–‡æœ¬ */
            --border-light: #334155; /* æ·±è‰²è¾¹æ¡† */
            --shadow: 0 2px 15px rgba(0, 0, 0, 0.5);
            --success-bg: #064e3b;
            --success-text: #a7f3d0;
            --error-bg: #4c1d95;
            --error-text: #f9a8d4;
            --info-bg: #1e3a8a;
            --info-text: #bfdbfe;
        }
        
        /* æ·±è‰²æ¨¡å¼é€‚é… */
        :root.dark-theme .options-list {
            background-color: #273449;
            border-color: var(--border-light);
        }
        
        :root.dark-theme .option-item {
            background-color: var(--bg-white);
            border-color: var(--border-light);
        }
        
        :root.dark-theme .option-item:hover {
            background-color: #273449;
        }
        
        :root.dark-theme .progress-bar {
            background-color: #334155;
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„è¾“å…¥æ¡†æ ·å¼ */
        :root.dark-theme input[type="text"]:focus,
        :root.dark-theme input[type="number"]:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æ¶ˆæ¯æç¤ºæ ·å¼ */
        :root.dark-theme .message-error {
            background-color: var(--error-bg);
            color: var(--error-text);
            border-color: rgba(236, 72, 153, 0.3);
        }
        
        :root.dark-theme .message-info {
            background-color: var(--info-bg);
            color: var(--info-text);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æ¸å˜èƒŒæ™¯ */
        :root.dark-theme .bg-info {
            background: linear-gradient(to right, rgba(99, 102, 241, 0.1), rgba(167, 139, 250, 0.1));
            border-color: rgba(99, 102, 241, 0.2);
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æ–‡æœ¬é¢œè‰² */
        :root.dark-theme .text-gray-600,
        :root.dark-theme .text-gray-700,
        :root.dark-theme .text-gray-500 {
            color: var(--text-gray) !important;
        }
        
        :root.dark-theme .text-neutral {
            color: var(--text-dark) !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        :root.dark-theme .btn-text:hover {
            color: #f472b6; /* ç²‰è‰²æ‚¬åœè‰² */
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„å¡ç‰‡é˜´å½± */
        :root.dark-theme .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        
        :root.dark-theme .card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.5;
            min-height: 100vh;
            /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸æ»šåŠ¨ */
            -webkit-tap-highlight-color: transparent;
            -webkit-overflow-scrolling: touch;
        }
        
        /* ç¡®ä¿æ·±è‰²æ¨¡å¼ä¸‹bodyæ ·å¼æ­£ç¡®åº”ç”¨ */
        :root.dark-theme body {
            background-color: var(--bg-light);
            color: var(--text-dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--bg-white);
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            padding: 1.5rem;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* å¸ƒå±€æ ·å¼ */
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        @media (min-width: 768px) {
            .grid-cols-12 {
                grid-template-columns: repeat(12, 1fr);
            }
            
            .md-col-span-5 {
                grid-column: span 5;
            }
            
            .md-col-span-7 {
                grid-column: span 7;
            }
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .card {
                padding: var(--spacing-md);
            }
            
            .options-list {
                max-height: 180px;
            }
            
            .progress-bar {
                height: 1rem;
            }
            
            /* è°ƒæ•´æ ‡é¢˜å¤§å° */
            h1 {
                font-size: 1.75rem !important;
            }
            
            h2 {
                font-size: 1.25rem !important;
            }
            
            /* å¢å¼ºè¿›åº¦æ¡åŠ¨ç”»æ•ˆæœ */
            .progress-fill {
                transition: width 0.8s ease;
            }
            
            /* è°ƒæ•´ä¸»é¢˜æŒ‰é’®å¤§å° */
            .theme-toggle {
                width: 3.25rem !important;
                height: 3.25rem !important;
                top: 1rem;
                right: 1rem;
            }
        }
        
        /* å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 0.75rem;
            }
            
            /* æŒ‰é’®ç»„å †å æ˜¾ç¤º */
            .flex.space-x-2 {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .flex.space-x-2 > * {
                margin-left: 0;
                margin-bottom: var(--spacing-sm);
            }
            
            /* ç»“æœé¡¹é—´è·è°ƒæ•´ */
            .result-item {
                margin-bottom: var(--spacing-md);
            }
        }
        
        /* æŒ‰é’®æ ·å¼ */
        button {
            cursor: pointer;
            font-family: inherit;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
            min-height: 2.5rem;
            box-sizing: border-box;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šæé«˜è§¦æ‘¸åŒºåŸŸ */
        @media (hover: none) and (pointer: coarse) {
            button,
            .btn,
            .option-item,
            .cache-item {
                min-height: 3rem;
                padding: 0.75rem 1rem;
            }
            
            /* é˜²æ­¢iOSç¼©æ”¾é—®é¢˜ */
            input[type="number"] {
                -webkit-appearance: textfield;
                -moz-appearance: textfield;
                appearance: textfield;
            }
            
            /* å¢å¼ºæŒ‰é’®è§¦æ‘¸åé¦ˆ */
            button:active,
            .btn:active,
            .option-item:active,
            .cache-item:active {
                transform: scale(0.98);
                transition: transform 0.1s;
            }
        }
        
        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
        }
        
        .theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text-dark);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
        }
        
        .btn-secondary {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: rgba(139, 92, 246, 0.9);
        }
        
        .btn-text {
            background: none;
            color: var(--text-gray);
            padding: 0.5rem;
        }
        
        .btn-text:hover {
            color: #EF4444;
        }
        
        .btn-text:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        input[type="text"],
        input[type="number"] {
            width: 100%;
            height: var(--input-height);
            padding: 0.75rem;
            border: 1px solid var(--border-light);
            border-radius: 0.5rem;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.2s ease;
            background-color: var(--bg-white);
            color: var(--text-dark);
            box-sizing: border-box;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        /* åˆ—è¡¨å’Œå®¹å™¨æ ·å¼ */
        .options-list {
            border: 1px solid var(--border-light);
            border-radius: 0.5rem;
            padding: 0.5rem;
            min-height: 150px;
            max-height: 200px;
            overflow-y: auto;
            background-color: #F9FAFB;
        }
        
        .options-list::-webkit-scrollbar {
            display: none;
        }
        
        .options-list {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-white);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .option-item:hover {
            background-color: #F9FAFB;
        }
        
        .result-item {
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            height: 1.25rem;
            background-color: #F3F4F6;
            border-radius: 9999px;
            overflow: hidden;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 9999px;
            transition: width 1.5s ease-out;
        }
        
        .bg-primary {
            background-color: var(--primary);
        }
        
        .bg-secondary {
            background-color: var(--secondary);
        }
        
        .bg-accent {
            background-color: var(--accent);
        }
        
        .bg-gradient-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }
        
        /* æ–‡æœ¬æ ·å¼ */
        .text-center {
            text-align: center;
        }
        
        .text-gray {
            color: var(--text-gray);
        }
        
        .text-primary {
            color: var(--primary);
        }
        
        .text-secondary {
            color: var(--secondary);
        }
        
        .text-accent {
            color: var(--accent);
        }
        
        .font-bold {
            font-weight: 700;
        }
        
        .font-semibold {
            font-weight: 600;
        }
        
        .font-medium {
            font-weight: 500;
        }
        
        .text-lg {
            font-size: 1.125rem;
        }
        
        .text-xl {
            font-size: 1.25rem;
        }
        
        .text-sm {
            font-size: 0.875rem;
        }
        
        /* é—´è·æ ·å¼ */
        .mb-2 {
            margin-bottom: 0.5rem;
        }
        
        .mb-4 {
            margin-bottom: 1rem;
        }
        
        .mb-6 {
            margin-bottom: 1.5rem;
        }
        
        .mb-8 {
            margin-bottom: 2rem;
        }
        
        .mt-4 {
            margin-top: 1rem;
        }
        
        .mt-8 {
            margin-top: 2rem;
        }
        
        .mt-12 {
            margin-top: 3rem;
        }
        
        .p-2 {
            padding: 0.5rem;
        }
        
        .p-3 {
            padding: 0.75rem;
        }
        
        .p-4 {
            padding: 1rem;
        }
        
        .p-6 {
            padding: 1.5rem;
        }
        
        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        
        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }
        
        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        
        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }
        
        .px-4 {
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }
        
        /* å¼¹æ€§å¸ƒå±€ */
        .flex {
            display: flex;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .justify-center {
            justify-content: center;
        }
        
        .space-x-2 > * + * {
            margin-left: 0.5rem;
        }
        
        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }
        
        .space-y-4 > * + * {
            margin-top: 1rem;
        }
        
        .space-y-5 > * + * {
            margin-top: 1.25rem;
        }
        
        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }
        
        /* é˜´å½±å’Œåœ†è§’ */
        .rounded-lg {
            border-radius: 0.5rem;
        }
        
        .rounded-xl {
            border-radius: 0.75rem;
        }
        
        .rounded-full {
            border-radius: 9999px;
        }
        
        .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        
        .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* è‡ªå®šä¹‰æ ·å¼ */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 1.5rem;
            width: 1.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.5rem;
        }
        
        .badge-primary {
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--primary);
        }
        
        .badge-gold {
            background-color: rgba(252, 211, 77, 0.1);
            color: #CA8A04;
        }
        
        .badge-silver {
            background-color: rgba(209, 213, 219, 0.1);
            color: #6B7280;
        }
        
        .badge-bronze {
            background-color: rgba(245, 158, 11, 0.1);
            color: #B45309;
        }
        
        .badge-gray {
            background-color: rgba(209, 213, 219, 0.1);
            color: #6B7280;
        }
        
        .w-full {
            width: 100%;
        }
        
        .flex-1 {
            flex: 1;
        }
        
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            background-image: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        /* æ¸å˜èƒŒæ™¯ */
        .bg-info {
            background: linear-gradient(to right, rgba(79, 70, 229, 0.05), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(79, 70, 229, 0.1);
        }
        
        /* æ¶ˆæ¯æç¤ºæ ·å¼ */
        .message-error {
            background-color: #FEF2F2;
            color: #DC2626;
            border: 1px solid #FEE2E2;
        }
        
        .message-info {
            background-color: #EFF6FF;
            color: #2563EB;
            border: 1px solid #DBEAFE;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
    </head>
    <body>
        <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
        <button id="themeToggle" class="theme-toggle" aria-label="åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path id="themeIcon" d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06z"/>
            </svg>
        </button>
        
        <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
        <button id="langToggle" class="theme-toggle" style="right: 70px;" aria-label="åˆ‡æ¢è¯­è¨€">
            <span id="langText" style="color: var(--text-dark); font-size: 14px; font-weight: bold;">ä¸­æ–‡</span>
        </button>
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <header class="text-center mb-8">
            <div class="inline-block p-3 rounded-full bg-primary/10 mb-4">
                <span class="text-3xl text-primary">ğŸ²</span>
            </div>
            <h1 id="headerTitle" class="text-[clamp(2rem,5vw,3rem)] font-bold text-gradient mb-2">éšæœºé€‰æ‹©å™¨</h1>
            <p id="headerSubtitle" class="text-gray-600 text-lg">é«˜æ•ˆæ·»åŠ é€‰é¡¹ï¼Œè‡ªå®šä¹‰éšæœºæ¬¡æ•°ï¼Œå¿«é€Ÿè·å–ç»“æœ</p>
        </header>

        <div class="grid md:grid-cols-12 gap-6">
            <!-- å·¦ä¾§è¾“å…¥åŒºåŸŸ -->
            <div class="md:col-span-5 bg-white rounded-xl shadow-card p-6 card">
                <h2 id="addOptionsTitle" class="text-xl font-semibold mb-4 flex items-center text-neutral">
                    <span class="text-accent mr-2">ğŸ“‹</span>æ·»åŠ é€‰é¡¹
                </h2>
                <p id="addOptionsSubtitle" class="text-gray-600 mb-4 text-sm">é€ä¸ªæ·»åŠ é€‰é¡¹ï¼Œæ·»åŠ å®Œæˆåç‚¹å‡»"å¼€å§‹éšæœºé€‰æ‹©"</p>
                
                <div class="space-y-4">
                    <!-- å•é€‰é¡¹è¾“å…¥æ¡†å’Œæ·»åŠ æŒ‰é’® -->
                    <div class="flex space-x-2">
                        <input 
                            id="singleOptionInput" 
                            type="text" 
                            class="flex-1 p-3 shadow-sm"
                            placeholder="è¾“å…¥ä¸€ä¸ªé€‰é¡¹..." autocomplete="off">
                        <button 
                            id="addOptionBtn" 
                            class="btn-secondary flex items-center justify-center whitespace-nowrap shadow-sm hover:shadow-md">
                            <span class="mr-2">+</span>æ·»åŠ é€‰é¡¹
                        </button>
                    </div>
                    
                    <!-- éšæœºæ¬¡æ•°è®¾ç½® -->
                    <div class="mt-4">
                        <label for="randomTimesInput" id="randomTimesLabel" class="block text-sm font-medium text-gray-700 mb-1">éšæœºæ¬¡æ•°</label>
                        <div class="flex space-x-2">
                            <input 
                                id="randomTimesInput" 
                                type="number" 
                                min="1" 
                                max="10000" 
                                value="100" 
                                class="flex-1 p-3 shadow-sm"
                                autocomplete="off">
                            <div class="bg-gray-50 px-3 py-3 rounded-lg border border-gray-200 text-gray-500 text-sm flex items-center">
                                æ¬¡
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½æŒ‰é’®ç»„ -->
                    <div class="flex space-x-2">
                        <button 
                            id="exportOptionsBtn" 
                            class="btn-text text-sm flex-1 flex items-center justify-center"
                            disabled>
                            <span class="mr-1">ğŸ“¥</span>å¯¼å‡ºé€‰é¡¹
                        </button>
                        <button 
                            id="importOptionsBtn" 
                            class="btn-text text-sm flex-1 flex items-center justify-center"
                            title="ç‚¹å‡»å¯¼å…¥é€‰é¡¹æ–‡ä»¶">
                            <span class="mr-1">ğŸ“¤</span>å¯¼å…¥é€‰é¡¹
                        </button>
                        <button 
                            id="clearOptionsBtn" 
                            class="btn-text text-sm flex-1 flex items-center justify-center"
                            disabled>
                            <span class="mr-1">ğŸ—‘ï¸</span>æ¸…ç©º
                        </button>
                        
                        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
                        <input 
                            type="file" 
                            id="importFileInput" 
                            accept=".txt,.json" 
                            style="display: none;">
                    </div>
                    
                    <!-- å·²æ·»åŠ é€‰é¡¹åˆ—è¡¨ -->
                    <div id="optionsList" class="options-list">
                    <p id="emptyOptionsText" class="text-gray text-center text-sm py-8">æš‚æ— é€‰é¡¹ï¼Œè¯·æ·»åŠ è‡³å°‘ä¸¤ä¸ªé€‰é¡¹</p>
                </div>
                </div>
                
                <button 
                    id="startBtn" 
                    class="w-full btn-primary flex items-center justify-center shadow-sm hover:shadow-md mt-4">
                    <span class="mr-2">â–¶ï¸</span>å¼€å§‹éšæœºé€‰æ‹©
                </button>
            </div>

            <!-- å³ä¾§ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <div class="md:col-span-7 bg-white rounded-xl shadow-card p-6 card">
                <h2 id="resultsTitle" class="text-xl font-semibold mb-4 flex items-center text-neutral">
                    <span class="text-secondary mr-2">ğŸ“Š</span>éšæœºç»“æœç»Ÿè®¡
                </h2>
                
                <div id="resultsContainer" class="min-h-[300px] flex items-center justify-center text-gray-500">
                    <p id="resultsPlaceholder" class="text-center">è¯·åœ¨å·¦ä¾§è¾“å…¥é€‰é¡¹å¹¶ç‚¹å‡»å¼€å§‹æŒ‰é’®</p>
                </div>
            </div>
        </div>

        <!-- è¯´æ˜ä¿¡æ¯ -->
        <div class="mt-8 bg-gradient-to-r from-primary/5 to-accent/5 border border-primary/10 p-4 rounded-xl">
            <h3 class="font-semibold text-primary flex items-center">
                <span class="mr-2">â„¹ï¸</span>ä½¿ç”¨è¯´æ˜
            </h3>
            <ul class="mt-2 text-gray-700 list-disc list-inside space-y-1 text-sm">
                <li>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥é€‰é¡¹å†…å®¹ï¼Œç‚¹å‡»"æ·»åŠ é€‰é¡¹"æŒ‰é’®æˆ–æŒ‰Enteré”®æ·»åŠ </li>
                <li>æ‚¨å¯ä»¥éšæ—¶åˆ é™¤å·²æ·»åŠ çš„é€‰é¡¹</li>
                <li>è‡³å°‘éœ€è¦æ·»åŠ 2ä¸ªé€‰é¡¹æ‰èƒ½è¿›è¡Œéšæœºé€‰æ‹©</li>
                <li>è®¾ç½®éšæœºæ¬¡æ•°ï¼Œç‚¹å‡»"å¼€å§‹éšæœºé€‰æ‹©"æŒ‰é’®åï¼Œç³»ç»Ÿä¼šä»æ‚¨æ·»åŠ çš„é€‰é¡¹ä¸­éšæœºé€‰æ‹©æŒ‡å®šæ¬¡æ•°</li>
                <li>å³ä¾§ä¼šæ˜¾ç¤ºæ¯ä¸ªé€‰é¡¹è¢«é€‰ä¸­çš„æ¬¡æ•°ã€ç™¾åˆ†æ¯”ä»¥åŠå¯è§†åŒ–å›¾è¡¨</li>
            </ul>
        </div>

        <!-- é¡µè„š -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>çº¯é»‘è“&é«˜æ•ˆéšæœºé€‰æ‹©å™¨ &copy; 2025 - å¿«é€Ÿã€å…¬å¹³ã€å¯è§†åŒ–</p>
        </footer>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„ä¸»é¢˜åå¥½
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark-theme');
                themeIcon.setAttribute('d', 'M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z');
            } else {
                themeIcon.setAttribute('d', 'M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06z');
            }
            
            // ä¸»é¢˜åˆ‡æ¢äº‹ä»¶ç›‘å¬
            themeToggle.addEventListener('click', function() {
                document.documentElement.classList.toggle('dark-theme');
                
                if (document.documentElement.classList.contains('dark-theme')) {
                    localStorage.setItem('theme', 'dark');
                    themeIcon.setAttribute('d', 'M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z');
                } else {
                    localStorage.setItem('theme', 'light');
                    themeIcon.setAttribute('d', 'M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06z');
                }
            });
        }
        
        // è¯­è¨€åŒ…å®šä¹‰
        const translations = {
            'zh-CN': {
                pageTitle: 'éšæœºé€‰æ‹©å™¨ - è‡ªå®šä¹‰æ¬¡æ•°',
                headerTitle: 'éšæœºé€‰æ‹©å™¨',
                headerSubtitle: 'é«˜æ•ˆæ·»åŠ é€‰é¡¹ï¼Œè‡ªå®šä¹‰éšæœºæ¬¡æ•°ï¼Œå¿«é€Ÿè·å–ç»“æœ',
                addOptionsTitle: 'æ·»åŠ é€‰é¡¹',
                addOptionsSubtitle: 'é€ä¸ªæ·»åŠ é€‰é¡¹ï¼Œæ·»åŠ å®Œæˆåç‚¹å‡»"å¼€å§‹éšæœºé€‰æ‹©"',
                optionPlaceholder: 'è¾“å…¥ä¸€ä¸ªé€‰é¡¹...',
                addOptionButton: 'æ·»åŠ é€‰é¡¹',
                randomTimesLabel: 'éšæœºæ¬¡æ•°',
                timesUnit: 'æ¬¡',
                exportOptionsButton: 'å¯¼å‡ºé€‰é¡¹',
                importOptionsButton: 'å¯¼å…¥é€‰é¡¹',
                clearButton: 'æ¸…ç©º',
                importOptionsTitle: 'å¯¼å…¥é€‰é¡¹',
                importOptionsDesc: 'è¯·ä¸Šä¼ åŒ…å«é€‰é¡¹çš„æ–‡æœ¬æ–‡ä»¶æˆ–JSONæ–‡ä»¶ã€‚æ–‡æœ¬æ–‡ä»¶æ¯è¡Œä¸€ä¸ªé€‰é¡¹ã€‚',
                startButton: 'å¼€å§‹éšæœºé€‰æ‹©',
                resultsTitle: 'éšæœºç»“æœç»Ÿè®¡',
                noOptionsMessage: 'æš‚æ— é€‰é¡¹ï¼Œè¯·æ·»åŠ è‡³å°‘ä¸¤ä¸ªé€‰é¡¹',
                noResultsMessage: 'è¯·åœ¨å·¦ä¾§è¾“å…¥é€‰é¡¹å¹¶ç‚¹å‡»å¼€å§‹æŒ‰é’®',
                useInstructionsTitle: 'ä½¿ç”¨è¯´æ˜',
                useInstruction1: 'åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥é€‰é¡¹å†…å®¹ï¼Œç‚¹å‡»"æ·»åŠ é€‰é¡¹"æŒ‰é’®æˆ–æŒ‰Enteré”®æ·»åŠ ',
                useInstruction2: 'æ‚¨å¯ä»¥éšæ—¶åˆ é™¤å·²æ·»åŠ çš„é€‰é¡¹',
                useInstruction3: 'è‡³å°‘éœ€è¦æ·»åŠ 2ä¸ªé€‰é¡¹æ‰èƒ½è¿›è¡Œéšæœºé€‰æ‹©',
                useInstruction4: 'è®¾ç½®éšæœºæ¬¡æ•°ï¼Œç‚¹å‡»"å¼€å§‹éšæœºé€‰æ‹©"æŒ‰é’®åï¼Œç³»ç»Ÿä¼šä»æ‚¨æ·»åŠ çš„é€‰é¡¹ä¸­éšæœºé€‰æ‹©æŒ‡å®šæ¬¡æ•°',
                useInstruction5: 'å³ä¾§ä¼šæ˜¾ç¤ºæ¯ä¸ªé€‰é¡¹è¢«é€‰ä¸­çš„æ¬¡æ•°ã€ç™¾åˆ†æ¯”ä»¥åŠå¯è§†åŒ–å›¾è¡¨',
                footerText: 'çº¯é»‘è“&é«˜æ•ˆéšæœºé€‰æ‹©å™¨ &copy; 2025 - å¿«é€Ÿã€å…¬å¹³ã€å¯è§†åŒ–',
                langText: 'ä¸­æ–‡',
                themeToggleAria: 'åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼',
                langToggleAria: 'åˆ‡æ¢è¯­è¨€',
                percentLabel: '%',
                timesLabel: 'æ¬¡',
                emptyOptionsMessage: 'è¯·æ·»åŠ è‡³å°‘ä¸¤ä¸ªé€‰é¡¹',
                importSuccessMessage: 'æˆåŠŸå¯¼å…¥ {count} ä¸ªé€‰é¡¹',
                importErrorMessage: 'å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼',
                exportConfirmMessage: 'é€‰é¡¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿',
                clearConfirmMessage: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é€‰é¡¹å—ï¼Ÿ',
                calculatingMessage: 'æ­£åœ¨è®¡ç®—...',
                emptyOptionError: 'è¯·è¾“å…¥é€‰é¡¹å†…å®¹',
                optionTooLongError: 'é€‰é¡¹å†…å®¹ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦',
                duplicateOptionError: 'è¯¥é€‰é¡¹å·²å­˜åœ¨ï¼Œè¯·è¾“å…¥å…¶ä»–é€‰é¡¹',
                noOptionsToClear: 'æ²¡æœ‰å¯æ¸…ç©ºçš„é€‰é¡¹',
                confirmClearOptions: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰é€‰é¡¹å—ï¼Ÿ',
                optionsCleared: 'é€‰é¡¹å·²æ¸…ç©º',
                noOptionsToExport: 'æ²¡æœ‰å¯å¯¼å‡ºçš„é€‰é¡¹',
                optionsExported: 'é€‰é¡¹å·²å¯¼å‡º',
                addOptionFirstError: 'è¯·å…ˆæ·»åŠ è‡³å°‘ä¸€ä¸ªé€‰é¡¹',
                countTooLowError: 'éšæœºæ¬¡æ•°ä¸èƒ½å°äº1',
                largeCountWarning: 'éšæœºæ¬¡æ•°è¿‡å¤šå¯èƒ½å¯¼è‡´æµè§ˆå™¨å¡é¡¿ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ',
                cacheFoundMessage: 'å‘ç°äº†ä¸å½“å‰é€‰é¡¹ç›¸åŒçš„ç¼“å­˜ç»“æœï¼ˆ{randomCount}æ¬¡éšæœºï¼‰\né€‰é¡¹: {optionCount}ä¸ª\næ˜¯å¦ä½¿ç”¨ç¼“å­˜ç»“æœï¼Ÿ',
                confirmClearCache: 'ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²ç¼“å­˜å—ï¼Ÿ',
                cacheCleared: 'ç¼“å­˜å·²æ¸…é™¤',
                cacheClearFailed: 'æ¸…é™¤ç¼“å­˜å¤±è´¥',
                noImportHistory: 'æš‚æ— å¯¼å…¥å†å²',
                cannotLoadImportHistory: 'æ— æ³•åŠ è½½å¯¼å…¥å†å²',
                importFileProcessing: 'æ­£åœ¨å¤„ç†å¯¼å…¥æ–‡ä»¶...',
                noValidOptionsInImport: 'å¯¼å…¥çš„æ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é€‰é¡¹',
                invalidImportFormat: 'å¯¼å…¥çš„æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘optionså­—æ®µ',
                confirmMergeImportedOptions: 'æ˜¯å¦å°†å¯¼å…¥çš„é€‰é¡¹ä¸ç°æœ‰é€‰é¡¹åˆå¹¶ï¼Ÿ\n{previewMessage}{settingsMessage}',
                confirmMergePastedOptions: 'æ˜¯å¦å°†ç²˜è´´çš„é…ç½®ä¸ç°æœ‰é€‰é¡¹åˆå¹¶ï¼Ÿ\n{settingsMessage}',
                mergeImportSuccess: 'æˆåŠŸå¯¼å…¥å¹¶åˆå¹¶ {newCount} ä¸ªé€‰é¡¹ï¼Œå½“å‰å…±æœ‰ {totalCount} ä¸ªé€‰é¡¹',
                importWithSettingsSuccess: 'æˆåŠŸå¯¼å…¥ {count} ä¸ªé€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨åº”ç”¨é…ç½®è®¾ç½®',
                importSuccess: 'æˆåŠŸå¯¼å…¥ {count} ä¸ªé€‰é¡¹',
                pasteSuccessWithSettings: 'æˆåŠŸç²˜è´´ {count} ä¸ªé€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨åº”ç”¨é…ç½®è®¾ç½®',
                pasteSuccess: 'æˆåŠŸç²˜è´´ {count} ä¸ªé€‰é¡¹',
                pasteWithMergeSuccess: 'æˆåŠŸç²˜è´´å¹¶åˆå¹¶ {newCount} ä¸ªé€‰é¡¹ï¼Œå½“å‰å…±æœ‰ {totalCount} ä¸ªé€‰é¡¹',
                noValidOptionsInPaste: 'ç²˜è´´çš„å†…å®¹ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é€‰é¡¹',
                confirmUpdateRandomTimes: 'æ˜¯å¦æ›´æ–°éšæœºæ¬¡æ•°è®¾ç½®ï¼Ÿ',
                fileReadFailed: 'æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æœªè¢«æŸå',
                importFileHelp: 'æ”¯æŒ JSON å’Œçº¯æ–‡æœ¬æ ¼å¼\nJSON æ ¼å¼å¯åŒ…å«å®Œæ•´é…ç½®\nçº¯æ–‡æœ¬æ ¼å¼æ¯è¡Œæˆ–ç”¨é€—å·åˆ†éš”ä¸€ä¸ªé€‰é¡¹',
                noCacheHistory: 'æš‚æ— ç¼“å­˜å†å²',
                currentResult: 'å½“å‰ç»“æœ',
                clickToRestore: 'ç‚¹å‡»æ¢å¤',
                olderRecords: 'è¿˜æœ‰ {count} æ¡æ›´æ—©çš„è®°å½•',
                expandCache: 'å±•å¼€å…¨éƒ¨è®°å½•',
                collapseCache: 'æ”¶èµ·è®°å½•',
                showAllRecords: 'å±•å¼€å…¨éƒ¨è®°å½•',
                hideOlderRecords: 'æ”¶èµ·è®°å½•',
                exportFileName: 'éšæœºé€‰æ‹©å™¨é…ç½®',
                importHistoryTitle: 'å¯¼å…¥å†å²',
                totalSelectionsLabel: 'æ€»é€‰æ‹©æ¬¡æ•°ï¼š',
                optionCountLabel: 'é€‰é¡¹æ•°é‡ï¼š'
            },
            'en-US': {
                pageTitle: 'Random Selector - Custom Times',
                headerTitle: 'Random Selector',
                headerSubtitle: 'Efficiently add options, customize random times, get results quickly',
                addOptionsTitle: 'Add Options',
                addOptionsSubtitle: 'Add options one by one, then click "Start Random Selection"',
                optionPlaceholder: 'Enter an option...',
                addOptionButton: 'Add Option',
                randomTimesLabel: 'Random Times',
                timesUnit: 'times',
                exportOptionsButton: 'Export Options',
                importOptionsButton: 'Import Options',
                clearButton: 'Clear',
                importOptionsTitle: 'Import Options',
                importOptionsDesc: 'Please upload a text file or JSON file containing options. Each line in text files represents one option.',
                startButton: 'Start Random Selection',
                resultsTitle: 'Random Results Statistics',
                noOptionsMessage: 'No options yet, please add at least two options',
                noResultsMessage: 'Please enter options on the left and click the start button',
                useInstructionsTitle: 'Instructions',
                useInstruction1: 'Enter option content in the input box, click "Add Option" button or press Enter to add',
                useInstruction2: 'You can delete added options at any time',
                useInstruction3: 'At least 2 options are required for random selection',
                useInstruction4: 'Set random times, click "Start Random Selection" button, the system will randomly select from your added options for the specified times',
                useInstruction5: 'The right side will show the number of times each option was selected, percentage, and visual chart',
                footerText: 'Pure Black Blue & Efficient Random Selector &copy; 2025 - Fast, Fair, Visual',
                langText: 'English',
                themeToggleAria: 'Toggle dark/light mode',
                langToggleAria: 'Toggle language',
                percentLabel: '%',
                timesLabel: 'times',
                emptyOptionsMessage: 'Please add at least two options',
                importSuccessMessage: 'Successfully imported {count} options',
                importErrorMessage: 'Import failed, please check file format',
                exportConfirmMessage: 'Options copied to clipboard',
                clearConfirmMessage: 'Are you sure you want to clear all options?',
                calculatingMessage: 'Calculating...',
                emptyOptionError: 'Please enter option content',
                optionTooLongError: 'Option content cannot exceed 50 characters',
                duplicateOptionError: 'This option already exists, please enter another option',
                noOptionsToClear: 'No options to clear',
                confirmClearOptions: 'Are you sure you want to clear all options?',
                optionsCleared: 'Options cleared',
                noOptionsToExport: 'No options to export',
                optionsExported: 'Options exported',
                addOptionFirstError: 'Please add at least one option first',
                countTooLowError: 'Random count cannot be less than 1',
                largeCountWarning: 'Too many random selections may cause browser lag, are you sure you want to continue?',
                cacheFoundMessage: 'Found cache result with identical options ({randomCount} random selections)\nOptions: {optionCount} items\nUse cached result?',
                confirmClearCache: 'Are you sure you want to clear all history cache?',
                cacheCleared: 'Cache cleared',
                cacheClearFailed: 'Failed to clear cache',
                noImportHistory: 'No import history',
                cannotLoadImportHistory: 'Cannot load import history',
                importFileProcessing: 'Processing import file...',
                noValidOptionsInImport: 'No valid options found in the imported file',
                invalidImportFormat: 'Imported file format is incorrect, missing options field',
                confirmMergeImportedOptions: 'Merge imported options with existing options?\n{previewMessage}{settingsMessage}',
                confirmMergePastedOptions: 'Merge pasted configuration with existing options?\n{settingsMessage}',
                mergeImportSuccess: 'Successfully imported and merged {newCount} options, currently have {totalCount} options',
                importWithSettingsSuccess: 'Successfully imported {count} options and automatically applied configuration settings',
                importSuccess: 'Successfully imported {count} options',
                pasteSuccessWithSettings: 'Successfully pasted {count} options and automatically applied configuration settings',
                pasteSuccess: 'Successfully pasted {count} options',
                pasteWithMergeSuccess: 'Successfully pasted and merged {newCount} options, currently have {totalCount} options',
                noValidOptionsInPaste: 'No valid options found in pasted content',
                confirmUpdateRandomTimes: 'Update random times setting?',
                fileReadFailed: 'File reading failed, please ensure the file is not corrupted',
                importFileHelp: 'Supports JSON and plain text formats\nJSON format can include complete configuration\nPlain text format: one option per line or separated by commas',
                noCacheHistory: 'No cache history',
                currentResult: 'Current Result',
                clickToRestore: 'Click to Restore',
                olderRecords: '{count} older records available',
                expandCache: 'Expand all records',
                collapseCache: 'Collapse records',
                showAllRecords: 'Show all records',
                hideOlderRecords: 'Hide older records',
                exportFileName: 'RandomSelector_Config',
                importHistoryTitle: 'Import History',
                totalSelectionsLabel: 'Total selections: ',
                optionCountLabel: 'Option count: '
            }
        };
        
        // å¤šè¯­è¨€æ”¯æŒåŠŸèƒ½
        let currentLang = 'zh-CN';
        
        function setupLanguageToggle() {
            const langToggle = document.getElementById('langToggle');
            const langText = document.getElementById('langText');
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„è¯­è¨€åå¥½
            const savedLang = localStorage.getItem('language');
            if (savedLang && translations[savedLang]) {
                currentLang = savedLang;
                updateTextContent(currentLang);
            }
            
            // è¯­è¨€åˆ‡æ¢äº‹ä»¶ç›‘å¬
            langToggle.addEventListener('click', function() {
                // åˆ‡æ¢è¯­è¨€
                currentLang = currentLang === 'zh-CN' ? 'en-US' : 'zh-CN';
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('language', currentLang);
                
                // æ›´æ–°é¡µé¢æ–‡æœ¬
                updateTextContent(currentLang);
            });
        }
        
        function updateTextContent(lang) {
            const t = translations[lang];
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = t.pageTitle;
            if (document.getElementById('pageTitle')) {
                document.getElementById('pageTitle').textContent = t.pageTitle;
            }
            
            // æ›´æ–°è¯­è¨€åˆ‡æ¢æŒ‰é’®æ–‡æœ¬
            document.getElementById('langText').textContent = t.langText;
            document.getElementById('langToggle').setAttribute('aria-label', t.langToggleAria);
            document.getElementById('themeToggle').setAttribute('aria-label', t.themeToggleAria);
            
            // æ›´æ–°é¡µé¢å†…å®¹
            if (document.getElementById('headerTitle')) {
                document.getElementById('headerTitle').textContent = t.headerTitle;
            }
            if (document.getElementById('headerSubtitle')) {
                document.getElementById('headerSubtitle').textContent = t.headerSubtitle;
            }
            
            // ä½¿ç”¨æ›´å¯é çš„æ–¹æ³•æ›´æ–°å¸¦å›¾æ ‡çš„æ ‡é¢˜
            if (document.getElementById('addOptionsTitle')) {
                document.getElementById('addOptionsTitle').innerHTML = `<span class="text-accent mr-2">ğŸ“‹</span>${t.addOptionsTitle}`;
            }
            if (document.getElementById('addOptionsSubtitle')) {
                document.getElementById('addOptionsSubtitle').textContent = t.addOptionsSubtitle;
            }
            
            document.getElementById('singleOptionInput').placeholder = t.optionPlaceholder;
            document.getElementById('addOptionBtn').innerHTML = `<span class="mr-2">+</span>${t.addOptionButton}`;
            
            if (document.getElementById('randomTimesLabel')) {
                document.getElementById('randomTimesLabel').textContent = t.randomTimesLabel;
            }
            const timesUnitElem = document.querySelector('.flex.space-x-2 .bg-gray-50');
            if (timesUnitElem) {
                timesUnitElem.textContent = t.timesUnit;
            }
            
            document.getElementById('exportOptionsBtn').innerHTML = `<span class="mr-1">ğŸ“¥</span>${t.exportOptionsButton}`;
            document.getElementById('importOptionsBtn').innerHTML = `<span class="mr-1">ğŸ“¤</span>${t.importOptionsButton}`;
            document.getElementById('clearOptionsBtn').innerHTML = `<span class="mr-1">ğŸ—‘ï¸</span>${t.clearButton}`;
            
            document.getElementById('startBtn').innerHTML = `<span class="mr-2">â–¶ï¸</span>${t.startButton}`;
            
            // ä½¿ç”¨æ›´å¯é çš„æ–¹æ³•æ›´æ–°å¸¦å›¾æ ‡çš„æ ‡é¢˜
            if (document.getElementById('resultsTitle')) {
                document.getElementById('resultsTitle').innerHTML = `<span class="text-secondary mr-2">ğŸ“Š</span>${t.resultsTitle}`;
            }
            
            if (document.getElementById('emptyOptionsText')) {
                document.getElementById('emptyOptionsText').textContent = t.noOptionsMessage;
            }
            if (document.getElementById('resultsPlaceholder')) {
                document.getElementById('resultsPlaceholder').textContent = t.noResultsMessage;
            }
            
            // æ›´æ–°ä½¿ç”¨è¯´æ˜éƒ¨åˆ†
            const useInstructionsTitleElem = document.querySelector('.mt-8 h3');
            if (useInstructionsTitleElem) {
                useInstructionsTitleElem.innerHTML = `<span class="mr-2">â„¹ï¸</span>${t.useInstructionsTitle}`;
            }
            
            const instructions = document.querySelector('.mt-8 ul')?.children || [];
            if (instructions[0]) instructions[0].textContent = t.useInstruction1;
            if (instructions[1]) instructions[1].textContent = t.useInstruction2;
            if (instructions[2]) instructions[2].textContent = t.useInstruction3;
            if (instructions[3]) instructions[3].textContent = t.useInstruction4;
            if (instructions[4]) instructions[4].textContent = t.useInstruction5;
            
            const footerText = document.querySelector('footer p');
            if (footerText) {
                footerText.textContent = t.footerText;
            }
            
            // æ›´æ–°HTML langå±æ€§
            document.documentElement.lang = lang;
        }
        
        // DOMContentLoadedç¡®ä¿DOMåŠ è½½å®Œæ¯•
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢
            setupThemeToggle();
            
            // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢
            setupLanguageToggle();
            
            // ç¼“å­˜DOMå…ƒç´ å¼•ç”¨
            const singleOptionInput = document.getElementById('singleOptionInput');
            const addOptionBtn = document.getElementById('addOptionBtn');
            const optionsList = document.getElementById('optionsList');
            const startBtn = document.getElementById('startBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const clearOptionsBtn = document.getElementById('clearOptionsBtn');
            const randomTimesInput = document.getElementById('randomTimesInput');
            
            // å­˜å‚¨é€‰é¡¹çš„æ•°ç»„
            let options = [];
            
            // ä½¿ç”¨DocumentFragmentå‡å°‘DOMæ“ä½œ
            function createDocumentFragment() {
                return document.createDocumentFragment();
            }

            // ä¸ºæ·»åŠ æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            addOptionBtn.addEventListener('click', addOption);
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ å›è½¦é”®å¤„ç†
            singleOptionInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addOption();
                }
            });
            
            // æ·»åŠ äº‹ä»¶å§”æ‰˜ï¼Œå¤„ç†åˆ é™¤æŒ‰é’®ç‚¹å‡»
            optionsList.addEventListener('click', (e) => {
                if (e.target.closest('.delete-option-btn')) {
                    const btn = e.target.closest('.delete-option-btn');
                    const index = parseInt(btn.getAttribute('data-index'));
                    deleteOption(index);
                }
            });

            // æ·»åŠ é€‰é¡¹å‡½æ•°
            function addOption() {
                const optionText = singleOptionInput.value.trim();
                
                if (!optionText) {
                    showMessage(t('emptyOptionError'), 'error');
                    return;
                }
                
                // ä½¿ç”¨Setå¿«é€Ÿæ£€æŸ¥é‡å¤ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
                if (options.includes(optionText)) {
                    showMessage(t('duplicateOptionError'), 'error');
                    return;
                }
                
                // æ·»åŠ é€‰é¡¹åˆ°æ•°ç»„
                options.push(optionText);
                
                // æ›´æ–°é€‰é¡¹åˆ—è¡¨æ˜¾ç¤º
                updateOptionsList();
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                singleOptionInput.value = '';
                singleOptionInput.focus();
            }
            
            // æ›´æ–°é€‰é¡¹åˆ—è¡¨æ˜¾ç¤ºå‡½æ•° - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
            function updateOptionsList() {
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateButtonsState();
                
                if (options.length === 0) {
                    optionsList.innerHTML = '<p class="text-gray-500 text-center text-sm py-8">æš‚æ— é€‰é¡¹ï¼Œè¯·æ·»åŠ è‡³å°‘ä¸¤ä¸ªé€‰é¡¹</p>';
                    return;
                }
                
                // ä½¿ç”¨DocumentFragmentå‡å°‘DOMé‡ç»˜
                const fragment = createDocumentFragment();
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'space-y-2';
                
                // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ‰¹é‡ç”ŸæˆHTMLï¼Œå‡å°‘DOMæ“ä½œ
                let optionsHtml = '';
                options.forEach((option, index) => {
                    optionsHtml += `
                        <div class="option-item">
                            <div class="flex items-center">
                                <span class="badge badge-primary">${index + 1}</span>
                                <span>${escapeHtml(option)}</span>
                            </div>
                            <button type="button" class="delete-option-btn text-gray-400 hover:text-red-500 transition-all" data-index="${index}">
                                <span>âœ•</span>
                            </button>
                        </div>
                    `;
                });
                
                optionsContainer.innerHTML = optionsHtml;
                fragment.appendChild(optionsContainer);
                
                // ä¸€æ¬¡æ€§æ›´æ–°DOM
                optionsList.innerHTML = '';
                optionsList.appendChild(fragment);
            }
            
            // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢XSSæ”»å‡»
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // åˆ é™¤é€‰é¡¹å‡½æ•°
            function deleteOption(index) {
                options.splice(index, 1);
                updateOptionsList();
            }
            
            // æ¸…ç©ºæ‰€æœ‰é€‰é¡¹å‡½æ•°
            function clearAllOptions() {
                if (options.length === 0) {
                    showMessage(t('noOptionsToClear'), 'info');
                    return;
                }
                
                if (confirm(t('confirmClearOptions'))) {
                    options = [];
                    updateOptionsList();
                    showMessage(t('optionsCleared'), 'success');
                    singleOptionInput.focus();
                }
            }
            
            // ä¸ºæ¸…ç©ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            clearOptionsBtn.addEventListener('click', clearAllOptions);
            
            // ä¸ºå¯¼å‡ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            exportOptionsBtn.addEventListener('click', exportOptions);
            
            // ä¸ºå¯¼å…¥æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            importOptionsBtn.addEventListener('click', importOptions);
            
            // ä¸ºæ–‡ä»¶è¾“å…¥æ·»åŠ å˜æ›´äº‹ä»¶
            importFileInput.addEventListener('change', handleFileImport);
            
            // è®¾ç½®ç²˜è´´å¯¼å…¥åŠŸèƒ½
            setupPasteImport();
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€å‡½æ•°
            function updateButtonsState() {
                // æ›´æ–°æ¸…ç©ºå’Œå¯¼å‡ºæŒ‰é’®çŠ¶æ€
                const isEmpty = options.length === 0;
                clearOptionsBtn.disabled = isEmpty;
                exportOptionsBtn.disabled = isEmpty;
                
                if (isEmpty) {
                    clearOptionsBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    exportOptionsBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    clearOptionsBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    exportOptionsBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
            
            // å¯¼å‡ºé€‰é¡¹å‡½æ•°
            function exportOptions() {
                if (options.length === 0) {
                    showMessage(t('noOptionsToExport'), 'info');
                    return;
                }
                
                // åˆ›å»ºå¯¼å‡ºæ•°æ®ï¼ŒåŒ…å«æ›´å¤šé…ç½®ä¿¡æ¯
                const exportData = {
                    options: options,
                    randomTimes: parseInt(randomTimesInput.value) || 1,
                    exportDate: new Date().toISOString(),
                    version: '1.1',
                    application: 'éšæœºé€‰æ‹©å™¨',
                    statistics: {
                        optionCount: options.length,
                        characterCount: options.reduce((sum, opt) => sum + opt.length, 0),
                        uniqueCharacters: new Set(options.join('')).size
                    }
                };
                
                // åˆ›å»ºBlob
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const a = document.createElement('a');
                a.href = url;
                
                // ç”Ÿæˆæ›´å…·æè¿°æ€§çš„æ–‡ä»¶å
                const dateTime = new Date().toLocaleDateString('zh-CN').replace(/\//g, '-') + 
                               '_' + 
                               new Date().toLocaleTimeString('zh-CN', {hour12: false}).replace(/:/g, '-');
                a.download = `éšæœºé€‰æ‹©å™¨é…ç½®_${options.length}é¡¹_${dateTime}.json`;
                document.body.appendChild(a);
                
                // ä¸ºä¸‹è½½æ·»åŠ åŠ¨ç”»æ•ˆæœ
                a.style.opacity = '0';
                a.style.pointerEvents = 'none';
                a.click();
                
                // æ¸…ç†
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                showMessage(t('optionsExported', {count: options.length}), 'info');
            }
            
            // å¯¼å…¥é€‰é¡¹å‡½æ•°
            function importOptions() {
                // æ˜¾ç¤ºå¯¼å…¥è¯´æ˜
                showMessage('æ”¯æŒ JSON å’Œçº¯æ–‡æœ¬æ ¼å¼\nJSON æ ¼å¼å¯åŒ…å«å®Œæ•´é…ç½®\nçº¯æ–‡æœ¬æ ¼å¼æ¯è¡Œæˆ–ç”¨é€—å·åˆ†éš”ä¸€ä¸ªé€‰é¡¹', 'info', 3000);
                
                // è§¦å‘æ–‡ä»¶é€‰æ‹©
                setTimeout(() => importFileInput.click(), 500);
            }
            
            // å¤„ç†æ–‡ä»¶å¯¼å…¥
            function handleFileImport(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
                showMessage('æ­£åœ¨å¤„ç†å¯¼å…¥æ–‡ä»¶...', 'info');
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        // å°è¯•JSONè§£æ
                        const data = JSON.parse(event.target.result);
                        
                        // éªŒè¯æ•°æ®æ ¼å¼
                        if (Array.isArray(data.options)) {
                            // å»é‡å¤„ç†
                            const newOptions = [...new Set(data.options)].filter(opt => opt.trim());
                            
                            if (newOptions.length === 0) {
                                showMessage('å¯¼å…¥çš„æ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é€‰é¡¹', 'error');
                                return;
                            }
                            
                            // å¯¼å…¥é¢„è§ˆ
                            const previewMessage = `\næ£€æµ‹åˆ° ${newOptions.length} ä¸ªé€‰é¡¹\n${newOptions.slice(0, 5).join('\n')}${newOptions.length > 5 ? '\n...' : ''}\n`;
                            
                            // æ£€æŸ¥æ˜¯å¦åŒ…å«é…ç½®ä¿¡æ¯
                            const hasSettings = data.randomTimes !== undefined;
                            let settingsMessage = '';
                            if (hasSettings) {
                                settingsMessage = `\nåŒæ—¶å¯¼å…¥è®¾ç½®: éšæœºæ¬¡æ•° = ${data.randomTimes}`;
                            }
                            
                            // åˆå¹¶æˆ–æ›¿æ¢é€‰é¡¹
                            const mergeOptions = options.length > 0 ? confirm('æ˜¯å¦å°†å¯¼å…¥çš„é€‰é¡¹ä¸ç°æœ‰é€‰é¡¹åˆå¹¶ï¼Ÿ' + previewMessage + settingsMessage) : false;
                            
                            if (mergeOptions) {
                                // åˆå¹¶å¹¶å»é‡
                                const mergedOptions = [...new Set([...options, ...newOptions])];
                                options = mergedOptions;
                                // å¦‚æœæœ‰è®¾ç½®ä¿¡æ¯ï¼Œè¯¢é—®æ˜¯å¦æ›´æ–°è®¾ç½®
                                if (hasSettings && confirm('æ˜¯å¦æ›´æ–°éšæœºæ¬¡æ•°è®¾ç½®ï¼Ÿ')) {
                                    randomTimesInput.value = data.randomTimes;
                                }
                                showMessage(`æˆåŠŸå¯¼å…¥å¹¶åˆå¹¶ ${newOptions.length} ä¸ªé€‰é¡¹ï¼Œå½“å‰å…±æœ‰ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                            } else {
                                // æ›¿æ¢
                                options = newOptions;
                                // è‡ªåŠ¨åº”ç”¨è®¾ç½®
                                if (hasSettings) {
                                    randomTimesInput.value = data.randomTimes;
                                    showMessage(`æˆåŠŸå¯¼å…¥ ${options.length} ä¸ªé€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨åº”ç”¨é…ç½®è®¾ç½®`, 'info');
                                } else {
                                    showMessage(`æˆåŠŸå¯¼å…¥ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                                }
                            }
                            
                            updateOptionsList();
                            
                            // è®°å½•å¯¼å…¥å†å²
                            recordImportHistory({
                                source: 'file',
                                fileName: file.name,
                                count: newOptions.length,
                                timestamp: new Date().toISOString()
                            });
                        } else {
                            showMessage('å¯¼å…¥çš„æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘optionså­—æ®µ', 'error');
                        }
                    } catch (error) {
                        // å°è¯•çº¯æ–‡æœ¬æ ¼å¼ï¼ˆæ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼‰
                        try {
                            const textContent = event.target.result;
                            // æ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼šæ¢è¡Œã€é€—å·ã€åˆ†å·ã€åˆ¶è¡¨ç¬¦
                            const textOptions = textContent
                                .split(/[\r\n,;\t]/)
                                .map(opt => opt.trim())
                                .filter(opt => opt);
                            
                            if (textOptions.length === 0) {
                                showMessage('å¯¼å…¥çš„æ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é€‰é¡¹', 'error');
                                return;
                            }
                            
                            // å»é‡
                            const newOptions = [...new Set(textOptions)];
                            
                            // å¯¼å…¥é¢„è§ˆ
                            const previewMessage = `\næ£€æµ‹åˆ° ${newOptions.length} ä¸ªé€‰é¡¹\n${newOptions.slice(0, 5).join('\n')}${newOptions.length > 5 ? '\n...' : ''}\n`;
                            
                            // åˆå¹¶æˆ–æ›¿æ¢é€‰é¡¹
                            const mergeOptions = options.length > 0 ? confirm('æ˜¯å¦å°†å¯¼å…¥çš„é€‰é¡¹ä¸ç°æœ‰é€‰é¡¹åˆå¹¶ï¼Ÿ' + previewMessage) : false;
                            
                            if (mergeOptions) {
                                const mergedOptions = [...new Set([...options, ...newOptions])];
                                options = mergedOptions;
                                showMessage(`æˆåŠŸå¯¼å…¥å¹¶åˆå¹¶ ${newOptions.length} ä¸ªé€‰é¡¹ï¼Œå½“å‰å…±æœ‰ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                            } else {
                                options = newOptions;
                                showMessage(`æˆåŠŸå¯¼å…¥ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                            }
                            
                            updateOptionsList();
                            
                            // è®°å½•å¯¼å…¥å†å²
                            recordImportHistory({
                                source: 'text_file',
                                fileName: file.name,
                                count: newOptions.length,
                                timestamp: new Date().toISOString()
                            });
                        } catch (textError) {
                            showMessage('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚æ”¯æŒJSONæ ¼å¼æˆ–ç”¨é€—å·/æ¢è¡Œåˆ†éš”çš„æ–‡æœ¬æ ¼å¼ã€‚', 'error');
                        }
                    }
                };
                
                reader.onerror = function() {
                    showMessage('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æœªè¢«æŸå', 'error');
                };
                
                // è¯»å–æ–‡ä»¶
                reader.readAsText(file);
                
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤å¯¼å…¥ç›¸åŒæ–‡ä»¶
                e.target.value = '';
            }
            
            // è®°å½•å¯¼å…¥å†å²
            function recordImportHistory(importInfo) {
                try {
                    let importHistory = JSON.parse(localStorage.getItem('randomSelectorImportHistory') || '[]');
                    importHistory.unshift(importInfo);
                    // åªä¿ç•™æœ€è¿‘5æ¡å†å²è®°å½•
                    if (importHistory.length > 5) {
                        importHistory = importHistory.slice(0, 5);
                    }
                    localStorage.setItem('randomSelectorImportHistory', JSON.stringify(importHistory));
                } catch (e) {
                    // é™é»˜å¤±è´¥ï¼Œä¸å½±å“ä¸»è¦åŠŸèƒ½
                }
            }
            
            // æ˜¾ç¤ºå¯¼å…¥å†å²
            function showImportHistory() {
                try {
                    const importHistory = JSON.parse(localStorage.getItem('randomSelectorImportHistory') || '[]');
                    if (importHistory.length === 0) {
                        showMessage(t('noImportHistory'), 'info');
                        return;
                    }
                    
                    const historyMessage = importHistory.map((item, index) => {
                        const date = new Date(item.timestamp).toLocaleString(getCurrentLocale());
                        const sourceType = item.source === 'file' ? t('fileSource') : item.source === 'text_file' ? t('textFileSource') : t('pasteSource');
                        return `${index + 1}. ${date}: ${t('importFrom')}${sourceType}${t('import')} ${item.count} ${t('options')}${item.fileName ? ' (' + item.fileName + ')' : ''}`;
                    }).join('\n');
                    
                    showMessage(t('importHistoryTitle') + ':\n' + historyMessage, 'info', 5000);
                } catch (e) {
                    showMessage(t('cannotLoadImportHistory'), 'error');
                }
            }
            
            // ç²˜è´´å¯¼å…¥åŠŸèƒ½ - å¢å¼ºç‰ˆ
            function setupPasteImport() {
                singleOptionInput.addEventListener('paste', function(e) {
                    // è·å–ç²˜è´´å†…å®¹
                    const pastedText = e.clipboardData.getData('text');
                    
                    // å°è¯•è¯†åˆ«æ˜¯å¦ä¸ºJSONé…ç½®
                    let isJsonConfig = false;
                    try {
                        const parsed = JSON.parse(pastedText);
                        isJsonConfig = parsed.options && Array.isArray(parsed.options);
                    } catch (e) {
                        // ä¸æ˜¯JSONï¼Œç»§ç»­å¤„ç†
                    }
                    
                    // å¦‚æœæ˜¯JSONé…ç½®æˆ–å¤šè¡Œ/å¤šé€—å·å†…å®¹ï¼Œè§¦å‘ç‰¹æ®Šå¤„ç†
                    if (isJsonConfig || (pastedText.includes('\n') || pastedText.includes(',') || pastedText.includes(';'))) {
                        e.preventDefault();
                        
                        if (isJsonConfig) {
                            // å¤„ç†JSONé…ç½®
                            const data = JSON.parse(pastedText);
                            const newOptions = [...new Set(data.options)].filter(opt => opt.trim());
                            
                            if (newOptions.length === 0) {
                                showMessage('ç²˜è´´çš„å†…å®¹ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é€‰é¡¹', 'error');
                                return;
                            }
                            
                            const hasSettings = data.randomTimes !== undefined;
                            let settingsMessage = '';
                            if (hasSettings) {
                                settingsMessage = `\nåŒæ—¶å¯¼å…¥è®¾ç½®: éšæœºæ¬¡æ•° = ${data.randomTimes}`;
                            }
                            
                            // åˆå¹¶æˆ–æ›¿æ¢é€‰é¡¹
                            const mergeOptions = options.length > 0 ? confirm('æ˜¯å¦å°†ç²˜è´´çš„é…ç½®ä¸ç°æœ‰é€‰é¡¹åˆå¹¶ï¼Ÿ' + settingsMessage) : false;
                            
                            if (mergeOptions) {
                                // åˆå¹¶å¹¶å»é‡
                                const mergedOptions = [...new Set([...options, ...newOptions])];
                                options = mergedOptions;
                                // å¦‚æœæœ‰è®¾ç½®ä¿¡æ¯ï¼Œè¯¢é—®æ˜¯å¦æ›´æ–°è®¾ç½®
                                if (hasSettings && confirm('æ˜¯å¦æ›´æ–°éšæœºæ¬¡æ•°è®¾ç½®ï¼Ÿ')) {
                                    randomTimesInput.value = data.randomTimes;
                                }
                                showMessage(`æˆåŠŸç²˜è´´å¹¶åˆå¹¶ ${newOptions.length} ä¸ªé€‰é¡¹ï¼Œå½“å‰å…±æœ‰ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                            } else {
                                // æ›¿æ¢
                                options = newOptions;
                                // è‡ªåŠ¨åº”ç”¨è®¾ç½®
                                if (hasSettings) {
                                    randomTimesInput.value = data.randomTimes;
                                    showMessage(`æˆåŠŸç²˜è´´ ${options.length} ä¸ªé€‰é¡¹ï¼Œå¹¶è‡ªåŠ¨åº”ç”¨é…ç½®è®¾ç½®`, 'info');
                                } else {
                                    showMessage(`æˆåŠŸç²˜è´´ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                                }
                            }
                        } else {
                            // è§£æç²˜è´´çš„æ–‡æœ¬å†…å®¹ï¼Œæ”¯æŒæ›´å¤šåˆ†éš”ç¬¦
                            const pastedOptions = pastedText
                                .split(/[\r\n,;\t]/)
                                .map(opt => opt.trim())
                                .filter(opt => opt);
                            
                            if (pastedOptions.length > 1) {
                                // å¯¼å…¥é¢„è§ˆ
                                const preview = pastedOptions.slice(0, 3).join('\n');
                                const previewMessage = pastedOptions.length > 3 ? `${preview}\n... ç­‰å…± ${pastedOptions.length} ä¸ªé€‰é¡¹` : preview;
                                
                                const confirmImport = confirm(`æ£€æµ‹åˆ°å¤šä¸ªé€‰é¡¹:\n${previewMessage}\n\næ˜¯å¦ä½œä¸ºå¤šä¸ªé€‰é¡¹å¯¼å…¥ï¼Ÿ`);
                                if (confirmImport) {
                                    // å»é‡
                                    const newOptions = [...new Set(pastedOptions)];
                                    
                                    // åˆå¹¶æˆ–æ›¿æ¢
                                    const mergeOptions = options.length > 0 && confirm('æ˜¯å¦å°†ç²˜è´´çš„é€‰é¡¹ä¸ç°æœ‰é€‰é¡¹åˆå¹¶ï¼Ÿ');
                                    
                                    if (mergeOptions) {
                                        const mergedOptions = [...new Set([...options, ...newOptions])];
                                        options = mergedOptions;
                                        showMessage(`æˆåŠŸç²˜è´´å¹¶åˆå¹¶ ${newOptions.length} ä¸ªé€‰é¡¹ï¼Œå½“å‰å…±æœ‰ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                                    } else {
                                        options = newOptions;
                                        showMessage(`æˆåŠŸç²˜è´´ ${options.length} ä¸ªé€‰é¡¹`, 'info');
                                    }
                                } else {
                                    // å¦‚æœç”¨æˆ·å–æ¶ˆå¯¼å…¥ï¼Œåˆ™æ­£å¸¸ç²˜è´´
                                    singleOptionInput.value = pastedText;
                                    return;
                                }
                            } else if (pastedOptions.length === 1) {
                                // å•ä¸ªé€‰é¡¹ï¼Œæ­£å¸¸ç²˜è´´
                                singleOptionInput.value = pastedOptions[0];
                                return;
                            }
                        }
                        
                        updateOptionsList();
                        
                        // è®°å½•å¯¼å…¥å†å²
                        recordImportHistory({
                            source: isJsonConfig ? 'pasted_config' : 'paste',
                            count: pastedOptions?.length || data.options.length,
                            timestamp: new Date().toISOString()
                        });
                    }
                });
            }

        // ä¸ºå¼€å§‹æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            startBtn.addEventListener('click', async () => {
                // æ£€æŸ¥é€‰é¡¹æ•°é‡
                if (options.length < 2) {
                    showMessage(t('emptyOptionsMessage'), 'error');
                    return;
                }
                
                // è·å–å¹¶éªŒè¯éšæœºæ¬¡æ•°
                let randomTimes = parseInt(randomTimesInput.value);
                
                // éªŒè¯è¾“å…¥
                if (isNaN(randomTimes) || randomTimes < 1) {
                    showMessage(t('countTooLowError'), 'error');
                    randomTimesInput.value = 100;
                    return;
                }
                
                // é™åˆ¶æœ€å¤§å€¼
                if (randomTimes > 10000) {
                    if (confirm(t('largeCountWarning'))) {
                        randomTimes = 10000;
                        randomTimesInput.value = 10000;
                    } else {
                        return;
                    }
                }

                // æ·»åŠ åŠ è½½çŠ¶æ€
                startBtn.disabled = true;
                let originalText = startBtn.innerHTML;
                startBtn.innerHTML = `<span class="mr-2">â³</span>${t('calculatingMessage')}`;
                
                try {
                    // å¯¹äºå¤§æ‰¹é‡æ•°æ®ï¼Œæ˜¾ç¤ºå¤„ç†è¿›åº¦
                    if (randomTimes > 2000) {
                        // æ˜¾ç¤ºè¿›åº¦æŒ‡ç¤ºå™¨
                        resultsContainer.innerHTML = `
                            <div class="flex flex-col items-center justify-center py-12">
                                <div class="text-5xl mb-4">ğŸ”„</div>
                                <p class="text-gray-600 mb-4">${t('calculatingMessage')}</p>
                                <div class="w-full max-w-sm bg-gray-200 rounded-full h-2.5">
                                    <div id="processProgress" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // ä½¿ç”¨å†…è”Web Workerå¤„ç†å¤§é‡éšæœºè®¡ç®—
                    function optimizedRandomSelectWithProgress(options, times) {
                        return new Promise((resolve, reject) => {
                            try {
                                // åˆ›å»ºå†…è”Web Workerï¼ŒåŒ…å«å¢å¼ºç‰ˆéšæœºç®—æ³•
                                const workerCode = `
                                    // è·å–åŠ å¯†å®‰å…¨çš„éšæœºæ•°
                                    function getSecureRandom() {
                                        const array = new Uint8Array(1);
                                        crypto.getRandomValues(array);
                                        return array[0] / 255; // å½’ä¸€åŒ–åˆ°0-1èŒƒå›´
                                    }
                                    
                                    // Fisher-Yates æ´—ç‰Œç®—æ³•
                                    function shuffleArray(array) {
                                        const result = [...array];
                                        for (let i = result.length - 1; i > 0; i--) {
                                            const j = Math.floor(getSecureRandom() * (i + 1));
                                            [result[i], result[j]] = [result[j], result[i]];
                                        }
                                        return result;
                                    }
                                    
                                    // å¢å¼ºç‰ˆéšæœºé€‰æ‹©å‡½æ•°
                                    function randomSelect(options, times, weights = null) {
                                        const optionsLength = options.length;
                                        
                                        // åˆå§‹åŒ–æƒé‡æ•°ç»„ï¼ˆé»˜è®¤ä¸ºç­‰æƒé‡ï¼‰
                                        const effectiveWeights = weights && weights.length === optionsLength ? 
                                            weights : new Array(optionsLength).fill(1);
                                        
                                        // è®¡ç®—æƒé‡æ€»å’Œ
                                        const totalWeight = effectiveWeights.reduce((sum, weight) => sum + weight, 0);
                                        
                                        // åˆå§‹åŒ–è®¡æ•°æ•°ç»„
                                        const countArray = new Array(optionsLength).fill(0);
                                        
                                        // åˆ†æ‰¹å¤„ç†ä»¥é¿å…é˜»å¡å¹¶æŠ¥å‘Šè¿›åº¦
                                        let processedTimes = 0;
                                        const batchSize = 10000;
                                        
                                        while (processedTimes < times) {
                                            const currentBatchSize = Math.min(batchSize, times - processedTimes);
                                            
                                            if (currentBatchSize > 1000) {
                                                // å¤§æ‰¹é‡ä½¿ç”¨æ´—ç‰Œç®—æ³•æé«˜å…¬å¹³æ€§
                                                // åˆ›å»ºæƒé‡æ•°ç»„
                                                const weightedOptions = [];
                                                for (let i = 0; i < optionsLength; i++) {
                                                    const weight = effectiveWeights[i];
                                                    const weightFactor = Math.max(1, Math.floor(weight * 10));
                                                    for (let j = 0; j < weightFactor; j++) {
                                                        weightedOptions.push(i); // å­˜å‚¨ç´¢å¼•
                                                    }
                                                }
                                                
                                                // æ´—ç‰Œ
                                                const shuffledIndices = shuffleArray(weightedOptions);
                                                
                                                // ä»æ´—ç‰Œåçš„æ•°ç»„ä¸­é€‰æ‹©
                                                for (let i = 0; i < currentBatchSize; i++) {
                                                    const selectedIndex = shuffledIndices[Math.floor(getSecureRandom() * shuffledIndices.length)];
                                                    countArray[selectedIndex]++;
                                                }
                                            } else {
                                                // å°æ‰¹é‡ä½¿ç”¨åŠ æƒéšæœºé€‰æ‹©
                                                for (let i = 0; i < currentBatchSize; i++) {
                                                    const randomValue = getSecureRandom() * totalWeight;
                                                    let cumulativeWeight = 0;
                                                    let selectedIndex = 0;
                                                    
                                                    for (let j = 0; j < optionsLength; j++) {
                                                        cumulativeWeight += effectiveWeights[j];
                                                        if (randomValue < cumulativeWeight) {
                                                            selectedIndex = j;
                                                            break;
                                                        }
                                                    }
                                                    
                                                    countArray[selectedIndex]++;
                                                }
                                            }
                                            
                                            // æ›´æ–°å·²å¤„ç†æ¬¡æ•°
                                            processedTimes += currentBatchSize;
                                            
                                            // è®¡ç®—å¹¶å‘é€è¿›åº¦
                                            const progress = (processedTimes / times) * 100;
                                            self.postMessage({ type: 'progress', progress: progress });
                                        }
                                        
                                        // æ„å»ºç»“æœå¯¹è±¡
                                        const finalResults = {};
                                        for (let i = 0; i < optionsLength; i++) {
                                            finalResults[options[i]] = countArray[i];
                                        }
                                        
                                        return finalResults;
                                    }
                                    
                                    // ç›‘å¬ä¸»çº¿ç¨‹æ¶ˆæ¯
                                    self.addEventListener('message', function(e) {
                                        const { options, times, weights } = e.data;
                                        
                                        try {
                                            const results = randomSelect(options, times, weights);
                                            self.postMessage({ type: 'result', results: results });
                                        } catch (error) {
                                            console.error('Workerè®¡ç®—é”™è¯¯:', error);
                                            self.postMessage({ type: 'error', error: error.message });
                                        } finally {
                                            // å®Œæˆåå…³é—­Worker
                                            self.close();
                                        }
                                    });
                                `;
                                
                                const worker = new Worker(URL.createObjectURL(new Blob([workerCode], { type: 'application/javascript' })));
                                
                                // ç›‘å¬Workeræ¶ˆæ¯
                                worker.addEventListener('message', function(e) {
                                    const { type, progress, results, error } = e.data;
                                    
                                    if (type === 'progress') {
                                        // æ›´æ–°è¿›åº¦æ¡
                                        if (randomTimes > 2000) {
                                            const progressBar = document.getElementById('processProgress');
                                            if (progressBar) {
                                                progressBar.style.width = `${Math.min(99, progress)}%`;
                                            }
                                        }
                                    } else if (type === 'result') {
                                        // è®¡ç®—å®Œæˆï¼Œå…³é—­Workerå¹¶è¿”å›ç»“æœ
                                        worker.terminate();
                                        resolve(results);
                                    } else if (type === 'error') {
                                        console.error('Workerè®¡ç®—é”™è¯¯:', error);
                                        worker.terminate();
                                        // å›é€€åˆ°ä¸»çº¿ç¨‹å¤„ç†
                                        console.warn('Workerå†…éƒ¨é”™è¯¯ï¼Œå›é€€åˆ°ä¸»çº¿ç¨‹è®¡ç®—');
                                        resolve(randomSelect(options, times));
                                    }
                                });
                                
                                // ç›‘å¬é”™è¯¯
                                worker.addEventListener('error', function(error) {
                                    console.error('Workeré”™è¯¯:', error);
                                    worker.terminate();
                                    
                                    // å›é€€åˆ°ä¸»çº¿ç¨‹å¤„ç†
                                    console.warn('Web Workerå¤±è´¥ï¼Œå›é€€åˆ°ä¸»çº¿ç¨‹è®¡ç®—');
                                    const fallbackResult = randomSelect(options, times);
                                    resolve(fallbackResult);
                                });
                                
                                // å‘é€æ•°æ®åˆ°Workerå¼€å§‹è®¡ç®—
                                worker.postMessage({ options, times, weights: null });
                                
                                // è¶…æ—¶å¤„ç†
                                setTimeout(() => {
                                    worker.terminate();
                                    console.warn('Workerè®¡ç®—è¶…æ—¶ï¼Œå›é€€åˆ°ä¸»çº¿ç¨‹');
                                    resolve(randomSelect(options, times));
                                }, 30000); // 30ç§’è¶…æ—¶
                                
                            } catch (error) {
                                console.error('åˆ›å»ºWeb Workerå¤±è´¥:', error);
                                // å›é€€åˆ°ä¸»çº¿ç¨‹å¤„ç†
                                console.warn('Web Workerä¸å¯ç”¨ï¼Œä½¿ç”¨ä¸»çº¿ç¨‹è®¡ç®—');
                                resolve(randomSelect(options, times));
                            }
                        });
                    }
                    
                    // è·³è¿‡ç¼“å­˜æ£€æŸ¥å’Œæç¤ºï¼Œç›´æ¥æ‰§è¡Œéšæœºé€‰æ‹©
                    // å¦‚éœ€æ¢å¤ç¼“å­˜æç¤ºï¼Œè¯·å–æ¶ˆæ³¨é‡Šä¸‹æ–¹ä»£ç 
                    /*
                    const cachedResult = cacheManager.findSimilar(options);
                    if (cachedResult && randomTimes <= 2000) {
                        const useCache = confirm(
                            t('cacheFoundMessage', {
                                randomCount: cachedResult.totalSelections,
                                optionCount: cachedResult.optionCount
                            })
                        );
                        
                        if (useCache) {
                            displayResults(cachedResult.results, cachedResult.totalSelections, cachedResult.id);
                            return;
                        }
                    }
                    */
                
                // æ‰§è¡Œéšæœºé€‰æ‹©
                let results;
                if (randomTimes <= 2000) {
                    // å°æ‰¹é‡æ•°æ®ç›´æ¥ä½¿ç”¨å·²ä¼˜åŒ–çš„åŒæ­¥å‡½æ•°
                    results = randomSelect(options, randomTimes);
                } else {
                    // å¤§æ‰¹é‡æ•°æ®ä½¿ç”¨å¸¦è¿›åº¦çš„å¼‚æ­¥å‡½æ•°
                    results = await optimizedRandomSelectWithProgress(options, randomTimes);
                }
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(results, randomTimes);
                } finally {
                    // æ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼Œéƒ½æ¢å¤æŒ‰é’®çŠ¶æ€
                    startBtn.disabled = false;
                    startBtn.innerHTML = originalText;
                }
            });

        // è·å–åŠ å¯†å®‰å…¨çš„éšæœºæ•°
        function getSecureRandom() {
            if (window.crypto && window.crypto.getRandomValues) {
                const array = new Uint8Array(1);
                window.crypto.getRandomValues(array);
                return array[0] / 255; // å½’ä¸€åŒ–åˆ°0-1èŒƒå›´
            }
            // å›é€€æ–¹æ¡ˆï¼šç»“åˆæ—¶é—´æˆ³æé«˜Math.random()çš„éšæœºæ€§
            const timeBasedSeed = Date.now() % 1000 / 1000;
            const mathRandom = Math.random();
            return (mathRandom + timeBasedSeed) % 1;
        }
        
        // Fisher-Yates æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            const result = [...array];
            for (let i = result.length - 1; i > 0; i--) {
                const j = Math.floor(getSecureRandom() * (i + 1));
                [result[i], result[j]] = [result[j], result[i]];
            }
            return result;
        }
        
        // å¸¦æƒé‡çš„éšæœºé€‰æ‹©å‡½æ•° - å¢å¼ºå…¬å¹³æ€§ç‰ˆæœ¬
        function randomSelect(options, times, weights = null) {
            const optionsLength = options.length;
            
            // åˆå§‹åŒ–æƒé‡æ•°ç»„ï¼ˆé»˜è®¤ä¸ºç­‰æƒé‡ï¼‰
            const effectiveWeights = weights && weights.length === optionsLength ? 
                weights : new Array(optionsLength).fill(1);
            
            // è®¡ç®—æƒé‡æ€»å’Œ
            const totalWeight = effectiveWeights.reduce((sum, weight) => sum + weight, 0);
            
            // åˆå§‹åŒ–è®¡æ•°æ•°ç»„
            const countArray = new Array(optionsLength).fill(0);
            
            // å¯¹äºå¤§é‡éšæœºé€‰æ‹©ï¼Œä½¿ç”¨æ´—ç‰Œç®—æ³•æé«˜å…¬å¹³æ€§
            if (times > 1000) {
                // æ‰¹é‡å¤„ç†ï¼Œæ¯æ‰¹æ¬¡æ´—ç‰Œåé€‰æ‹©
                const batchSize = Math.min(1000, times);
                let remainingTimes = times;
                
                while (remainingTimes > 0) {
                    const currentBatchSize = Math.min(batchSize, remainingTimes);
                    
                    // åˆ›å»ºæƒé‡æ•°ç»„ï¼ˆæ ¹æ®æƒé‡å¤åˆ¶é€‰é¡¹ï¼‰
                    const weightedOptions = [];
                    for (let i = 0; i < optionsLength; i++) {
                        const weight = effectiveWeights[i];
                        // å¯¹äºæƒé‡è¾ƒå¤§çš„é€‰é¡¹ï¼Œå°†å…¶æ·»åŠ åˆ°æ•°ç»„ä¸­å¤šæ¬¡
                        // è¿™é‡Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬ï¼ŒçœŸå®åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´ç²¾ç¡®çš„æƒé‡å¤„ç†
                        const weightFactor = Math.max(1, Math.floor(weight * 10));
                        for (let j = 0; j < weightFactor; j++) {
                            weightedOptions.push(i); // å­˜å‚¨ç´¢å¼•è€Œä¸æ˜¯é€‰é¡¹æ–‡æœ¬
                        }
                    }
                    
                    // æ´—ç‰Œ
                    const shuffledIndices = shuffleArray(weightedOptions);
                    
                    // ä»æ´—ç‰Œåçš„æ•°ç»„ä¸­é€‰æ‹©
                    for (let i = 0; i < currentBatchSize; i++) {
                        const selectedIndex = shuffledIndices[Math.floor(getSecureRandom() * shuffledIndices.length)];
                        countArray[selectedIndex]++;
                    }
                    
                    remainingTimes -= currentBatchSize;
                }
            } else {
                // å¯¹äºå°‘é‡éšæœºé€‰æ‹©ï¼Œä½¿ç”¨åŠ æƒéšæœºé€‰æ‹©
                for (let i = 0; i < times; i++) {
                    // ä½¿ç”¨åŠ æƒéšæœºé€‰æ‹©ç®—æ³•
                    const randomValue = getSecureRandom() * totalWeight;
                    let cumulativeWeight = 0;
                    let selectedIndex = 0;
                    
                    for (let j = 0; j < optionsLength; j++) {
                        cumulativeWeight += effectiveWeights[j];
                        if (randomValue < cumulativeWeight) {
                            selectedIndex = j;
                            break;
                        }
                    }
                    
                    countArray[selectedIndex]++;
                }
            }
            
            // æ„å»ºç»“æœå¯¹è±¡
            const finalResults = {};
            for (let i = 0; i < optionsLength; i++) {
                finalResults[options[i]] = countArray[i];
            }
            
            return finalResults;
        }

        // ç¼“å­˜ç®¡ç†å™¨
        const cacheManager = {
            MAX_CACHE_ITEMS: 10,
            
            // ä¿å­˜ç»“æœåˆ°ç¼“å­˜
            saveResult: function(results, options, totalSelections) {
                try {
                    // åˆ›å»ºç¼“å­˜é¡¹
                    const cacheItem = {
                        id: Date.now(),
                        timestamp: new Date().toLocaleString(),
                        options: [...options], // ä¿å­˜åŸå§‹é€‰é¡¹
                        results: { ...results },
                        totalSelections
                    };
                    
                    // è·å–ç°æœ‰ç¼“å­˜
                    const cache = this.getCache();
                    
                    // æ·»åŠ æ–°é¡¹åˆ°å¼€å¤´
                    cache.unshift(cacheItem);
                    
                    // é™åˆ¶ç¼“å­˜å¤§å°
                    if (cache.length > this.MAX_CACHE_ITEMS) {
                        cache.splice(this.MAX_CACHE_ITEMS);
                    }
                    
                    // ä¿å­˜åˆ°localStorage
                    localStorage.setItem('random-selector-cache', JSON.stringify(cache));
                    
                    return cacheItem.id;
                } catch (error) {
                    console.error('ä¿å­˜ç¼“å­˜å¤±è´¥:', error);
                    return null;
                }
            },
            
            // è·å–æ‰€æœ‰ç¼“å­˜
            getCache: function() {
                try {
                    const cacheStr = localStorage.getItem('random-selector-cache');
                    return cacheStr ? JSON.parse(cacheStr) : [];
                } catch (error) {
                    console.error('è¯»å–ç¼“å­˜å¤±è´¥:', error);
                    return [];
                }
            },
            
            // é€šè¿‡IDè·å–ç¼“å­˜
            getById: function(id) {
                const cache = this.getCache();
                return cache.find(item => item.id === id) || null;
            },
            
            // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
            clearCache: function() {
                try {
                    localStorage.removeItem('random-selector-cache');
                    return true;
                } catch (error) {
                    console.error('æ¸…é™¤ç¼“å­˜å¤±è´¥:', error);
                    return false;
                }
            },
            
            // æ ¹æ®å½“å‰é€‰é¡¹æŸ¥æ‰¾ç›¸ä¼¼çš„ç¼“å­˜
            findSimilar: function(currentOptions) {
                const cache = this.getCache();
                
                // é€‰é¡¹é›†åˆçš„æ¯”è¾ƒå‡½æ•°
                const optionsMatch = (opts1, opts2) => {
                    if (opts1.length !== opts2.length) return false;
                    const set1 = new Set(opts1);
                    const set2 = new Set(opts2);
                    return [...set1].every(opt => set2.has(opt));
                };
                
                return cache.find(item => optionsMatch(item.options, currentOptions));
            }
        };
        
        // æ˜¾ç¤ºç»“æœå‡½æ•° - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆå¸¦ç¼“å­˜åŠŸèƒ½ï¼‰
        function displayResults(results, totalSelections, cacheId = null) {
            // ä¿å­˜ç»“æœåˆ°ç¼“å­˜
            if (!cacheId) {
                cacheId = cacheManager.saveResult(results, options, totalSelections);
            }
            
            // ä½¿ç”¨DocumentFragmentå‡å°‘DOMé‡ç»˜
            const fragment = document.createDocumentFragment();
            
            // å°†ç»“æœè½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æ¬¡æ•°æ’åº
            const sortedResults = Object.entries(results)
                .sort((a, b) => b[1] - a[1]);
            
            // åˆ›å»ºç»“æœå®¹å™¨
            const resultsWrapper = document.createElement('div');
            resultsWrapper.className = 'space-y-5 w-full';
            
            // æ·»åŠ ç»Ÿè®¡æ‘˜è¦å’Œç¼“å­˜æ“ä½œ
            const summaryCard = document.createElement('div');
            summaryCard.className = 'p-4 rounded-lg border border-gray-100';
            summaryCard.style.backgroundColor = 'var(--card-background)';
            summaryCard.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">${t('totalSelectionsLabel')}</span>
                    <span class="font-semibold text-primary">${totalSelections}${t('timesUnit')}</span>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">${t('optionCountLabel')}</span>
                    <span class="font-semibold text-primary">${sortedResults.length}${t('timesUnit')}</span>
                </div>
                <div class="flex justify-between items-center mt-3">
                    <div class="text-sm text-gray-500">
                        <span id="cacheTimestamp">${new Date().toLocaleString()}</span>
                        ${cacheId ? `<span class="ml-2">ï¼ˆå·²ç¼“å­˜ï¼‰</span>` : ''}
                    </div>
                    <button id="clearCacheBtn" class="text-sm px-3 py-1 rounded hover:bg-gray-200 transition-colors">
                        ${t('confirmClearCache')}
                    </button>
                </div>`;
            resultsWrapper.appendChild(summaryCard);
            
            // æ·»åŠ ç¼“å­˜å†å²åŒºåŸŸ - ä½¿ç”¨æœ€åŸºç¡€çš„JavaScriptè¯­æ³•
            var cacheHistorySection = document.createElement('div');
            cacheHistorySection.className = 'p-4 rounded-lg border border-gray-100';
            cacheHistorySection.style.backgroundColor = 'var(--card-background)';
            
            // ç¼“å­˜å±•å¼€çŠ¶æ€ - ä½¿ç”¨ç®€å•çš„å˜é‡
            var isCacheExpanded = false;
            
            // ç®€å•çš„åˆ‡æ¢å‡½æ•° - ä¸“é—¨ç”¨äºå¤„ç†æŒ‰é’®ç‚¹å‡»
            function toggleCacheDisplay() {
                isCacheExpanded = !isCacheExpanded;
                displayCacheHistory();
                bindCacheItemEvents();
            }
            
            // æ˜¾ç¤ºç¼“å­˜å†å² - ä½¿ç”¨æœ€åŸºç¡€çš„JSè¯­æ³•
            function displayCacheHistory() {
                var cacheItems = cacheManager.getCache();
                
                if (cacheItems.length === 0) {
                    // æ²¡æœ‰ç¼“å­˜è®°å½•çš„ç®€å•æƒ…å†µ
                    cacheHistorySection.innerHTML = '';
                    var h3 = document.createElement('h3');
                    h3.className = 'font-medium mb-2';
                    h3.textContent = t('importHistoryTitle');
                    cacheHistorySection.appendChild(h3);
                    
                    var p = document.createElement('p');
                    p.className = 'text-gray-500 text-sm';
                    p.textContent = t('noCacheHistory');
                    cacheHistorySection.appendChild(p);
                    return;
                }
                
                // æ¸…ç©ºç°æœ‰å†…å®¹
                cacheHistorySection.innerHTML = '';
                
                // åˆ›å»ºå¤´éƒ¨å®¹å™¨
                var header = document.createElement('div');
                header.className = 'flex justify-between items-center mb-3';
                
                // æ·»åŠ æ ‡é¢˜
                var title = document.createElement('h3');
                title.className = 'font-medium';
                title.textContent = t('importHistoryTitle');
                header.appendChild(title);
                
                // å¦‚æœæœ‰è¶…è¿‡3æ¡è®°å½•ï¼Œæ·»åŠ åˆ‡æ¢æŒ‰é’®
                if (cacheItems.length > 3) {
                    var toggleBtn = document.createElement('button');
                    toggleBtn.id = 'toggleCacheBtn';
                    toggleBtn.className = 'text-xs px-2 py-1 rounded bg-gray-200 hover:bg-gray-300 transition-colors';
                    // æ ¹æ®çŠ¶æ€è®¾ç½®æŒ‰é’®æ–‡æœ¬
                    if (isCacheExpanded) {
                        toggleBtn.textContent = t('hideOlderRecords');
                    } else {
                        toggleBtn.textContent = t('showAllRecords');
                    }
                    // ç›´æ¥ç»‘å®šç‚¹å‡»äº‹ä»¶
                    toggleBtn.onclick = toggleCacheDisplay;
                    header.appendChild(toggleBtn);
                }
                
                cacheHistorySection.appendChild(header);
                
                // åˆ›å»ºå†…å®¹å®¹å™¨
                var contentContainer = document.createElement('div');
                contentContainer.className = 'space-y-2';
                
                // æ ¹æ®å±•å¼€çŠ¶æ€å†³å®šæ˜¾ç¤ºæ•°é‡
                var displayCount;
                if (isCacheExpanded) {
                    displayCount = cacheItems.length;
                } else {
                    displayCount = 3;
                }
                
                // æ·»åŠ ç¼“å­˜è®°å½•é¡¹
                for (var i = 0; i < displayCount; i++) {
                    if (i >= cacheItems.length) break;
                    
                    var item = cacheItems[i];
                    var cacheDiv = document.createElement('div');
                    var isCurrentClass = '';
                    if (item.id === cacheId) {
                        isCurrentClass = ' bg-gray-100';
                    }
                    cacheDiv.className = 'cache-item' + isCurrentClass + ' p-2 rounded cursor-pointer hover:bg-gray-50 transition-colors';
                    
                    // è®¡ç®—ç»“æœæ•°é‡
                    var resultCount = 0;
                    for (var key in item.results) {
                        if (item.results.hasOwnProperty(key)) {
                            resultCount += item.results[key];
                        }
                    }
                    
                    // ç¬¬ä¸€è¡Œï¼šæ—¶é—´æˆ³å’ŒçŠ¶æ€
                    var topRow = document.createElement('div');
                    topRow.className = 'flex justify-between items-center';
                    
                    var timeSpan = document.createElement('span');
                    timeSpan.className = 'text-sm';
                    timeSpan.textContent = item.timestamp;
                    topRow.appendChild(timeSpan);
                    
                    var statusSpan = document.createElement('span');
                    statusSpan.className = 'text-xs px-2 py-1 rounded';
                    if (item.id === cacheId) {
                        statusSpan.className += ' bg-primary text-white';
                        statusSpan.textContent = t('currentResult');
                    } else {
                        statusSpan.className += ' bg-gray-200';
                        statusSpan.textContent = t('clickToRestore');
                    }
                    topRow.appendChild(statusSpan);
                    
                    // ç¬¬äºŒè¡Œï¼šé€‰é¡¹å’Œæ¬¡æ•°
                    var bottomRow = document.createElement('div');
                    bottomRow.className = 'flex justify-between items-center mt-1 text-xs text-gray-500';
                    
                    var optionsSpan = document.createElement('span');
                    optionsSpan.textContent = 'é€‰é¡¹: ' + item.options.length + 'ä¸ª';
                    bottomRow.appendChild(optionsSpan);
                    
                    var countSpan = document.createElement('span');
                    countSpan.textContent = 'éšæœºæ¬¡æ•°: ' + resultCount + 'æ¬¡';
                    bottomRow.appendChild(countSpan);
                    
                    // ç»„è£…ç¼“å­˜é¡¹
                    cacheDiv.appendChild(topRow);
                    cacheDiv.appendChild(bottomRow);
                    
                    contentContainer.appendChild(cacheDiv);
                }
                
                cacheHistorySection.appendChild(contentContainer);
                
                // å¦‚æœæœªå±•å¼€ä¸”æœ‰æ›´å¤šè®°å½•ï¼Œæ˜¾ç¤ºæç¤º
                if (!isCacheExpanded && cacheItems.length > 3) {
                    var moreHint = document.createElement('p');
                    moreHint.className = 'text-xs text-gray-500 mt-2';
                    // é¿å…å¤æ‚è¯­æ³•ï¼Œç›´æ¥ä¼ é€’å¯¹è±¡
                    var countObj = {count: cacheItems.length - 3};
                    moreHint.textContent = t('olderRecords', countObj);
                    cacheHistorySection.appendChild(moreHint);
                }
            }
            
            // ç»‘å®šç¼“å­˜é¡¹ç‚¹å‡»äº‹ä»¶çš„å‡½æ•°ï¼Œé¿å…é‡å¤ç»‘å®š
            const bindCacheItemEvents = () => {
                setTimeout(() => {
                    const cacheItems = document.querySelectorAll('.cache-item');
                    cacheItems.forEach(item => {
                        // å…ˆç§»é™¤å¯èƒ½å­˜åœ¨çš„äº‹ä»¶ç›‘å¬å™¨
                        const newItem = item.cloneNode(true);
                        item.parentNode.replaceChild(newItem, item);
                        
                        newItem.addEventListener('click', function() {
                            // æ‰¾åˆ°å¯¹åº”ç¼“å­˜
                            const cacheItems = cacheManager.getCache();
                            const cacheItem = cacheItems.find(c => 
                                c.timestamp === this.querySelector('.text-sm').textContent
                            );
                            
                            if (cacheItem) {
                                // æ¢å¤ç¼“å­˜ç»“æœ
                                displayResults(cacheItem.results, cacheItem.totalSelections, cacheItem.id);
                            }
                        });
                    });
                }, 10); // ç¨å¾®å»¶è¿Ÿä»¥ç¡®ä¿DOMå·²æ›´æ–°
            };
            
            // åˆå§‹åŒ–æ˜¾ç¤ºç¼“å­˜å†å²
            displayCacheHistory();
            resultsWrapper.appendChild(cacheHistorySection);
            
            // æ‰¹é‡ç”Ÿæˆç»“æœHTMLï¼Œå‡å°‘DOMæ“ä½œ
            let resultsHtml = '';
            sortedResults.forEach(([option, count], index) => {
                const percentage = ((count / totalSelections) * 100).toFixed(1);
                
                // æ ¹æ®æ’åè®¾ç½®ä¸åŒçš„è¿›åº¦æ¡é¢œè‰²å’Œå¾½ç« æ ·å¼
                let barColor = 'bg-primary';
                let badgeClass = 'badge-gray';
                
                if (index === 0) {
                    barColor = 'bg-gradient-primary';
                    badgeClass = 'badge-gold';
                } else if (index === 1) {
                    barColor = 'bg-secondary';
                    badgeClass = 'badge-silver';
                } else if (index === 2) {
                    barColor = 'bg-accent';
                    badgeClass = 'badge-bronze';
                }
                
                resultsHtml += `
                    <div class="result-item">
                        <div class="flex justify-between mb-2">
                            <div class="flex items-center">
                                <span class="badge ${badgeClass}">${index + 1}</span>
                                <span class="font-medium">${escapeHtml(option)}</span>
                            </div>
                            <span class="font-semibold">${count}æ¬¡ <span class="text-primary">(${percentage}%)</span></span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${barColor}" style="width: 0%" data-percent="${percentage}"></div>
                        </div>
                    </div>
                `;
            });
            
            const resultsList = document.createElement('div');
            resultsList.className = 'space-y-4';
            resultsList.innerHTML = resultsHtml;
            resultsWrapper.appendChild(resultsList);
            
            fragment.appendChild(resultsWrapper);
            
            // ä¸€æ¬¡æ€§æ›´æ–°DOM
            resultsContainer.innerHTML = '';
            resultsContainer.appendChild(fragment);
            
            // è§¦å‘è¿›åº¦æ¡åŠ¨ç”»ï¼Œä½¿ç”¨requestAnimationFrameç¡®ä¿DOMå·²æ›´æ–°
            requestAnimationFrame(() => {
                const progressBars = document.querySelectorAll('.result-item .progress-fill[data-percent]');
                progressBars.forEach((bar, index) => {
                    // ä¸ºæ¯ä¸ªè¿›åº¦æ¡æ·»åŠ ä¸€ç‚¹å»¶è¿Ÿï¼Œåˆ›å»ºçº§è”æ•ˆæœ
                    setTimeout(() => {
                        bar.style.width = `${bar.dataset.percent}%`;
                    }, index * 100);
                });
            });
            
            // æ¸…é™¤ç¼“å­˜æŒ‰é’®äº‹ä»¶ç›‘å¬
            const clearCacheBtn = document.getElementById('clearCacheBtn');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', function() {
                    if (confirm(t('confirmClearCache'))) {
                        if (cacheManager.clearCache()) {
                            showMessage(t('cacheCleared'), 'info');
                            
                            // é‡æ–°åŠ è½½é¡µé¢ä»¥é‡ç½®æ‰€æœ‰çŠ¶æ€
                            setTimeout(() => {
                                location.reload();
                            }, 1000);
                        } else {
                            showMessage(t('cacheClearFailed'), 'error');
                        }
                    }
                });
            }
            
            // ä½¿ç”¨æ–°çš„ç¼“å­˜é¡¹äº‹ä»¶ç»‘å®šå‡½æ•°
            bindCacheItemEvents();
        }

        // è·å–å½“å‰è¯­è¨€çš„ç¿»è¯‘
        function t(key, params = {}) {
            let text = translations[currentLang][key] || key;
            // æ›¿æ¢å‚æ•°
            Object.keys(params).forEach(param => {
                text = text.replace(new RegExp(`\\{${param}\\}`, 'g'), params[param]);
            });
            return text;
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function showMessage(text, type = 'info') {
            // ä½¿ç”¨DocumentFragmentå‡å°‘DOMæ“ä½œ
            const fragment = document.createDocumentFragment();
            
            const messageBox = document.createElement('div');
            messageBox.className = `p-4 rounded-lg text-center transition-all duration-300 transform animate-fadeIn ${type === 'error' ? 'message-error shadow-sm' : 'message-info shadow-sm'}`;
            
            messageBox.innerHTML = `
                <span class="mr-2">${type === 'error' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                ${text}
            `;
            
            fragment.appendChild(messageBox);
            
            // ä¸€æ¬¡æ€§æ›´æ–°DOM
            resultsContainer.innerHTML = '';
            resultsContainer.appendChild(fragment);
        }
    }); // DOMContentLoadedç»“æŸ


    </script>
</body>
</html>
